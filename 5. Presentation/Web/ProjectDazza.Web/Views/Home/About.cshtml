@using System.Web.Script.Serialization;

@model ProjectDazza.Web.Models.AddressModel

@{
	string json = new JavaScriptSerializer().Serialize(Model);
}

<script src="~/Scripts/kendo.all.min.js" type="text/javascript"></script>

<div id="mainform">
	<form action="@Url.Action("Save")" method="post" onsubmit="model.HandleSubmit()">
		<input type="hidden" id="jsondata" value="@json" name="jsondata" />

		<div class="row">
			<input data-bind="value: name" type="text" placeholder="Name" />
		</div>
		<div class="row">
			<input data-bind="value: address" type="text" placeholder="Address" />
		</div>
		<div class="row">
			<input id="postcode" data-bind="value: postcode" type="text" placeholder="Postcode" />
		</div>

		<div class="row">
			<select data-bind="source: countries, value: country"></select>
		</div>

		<button	type="submit">Submit</button>
	</form>

	<div data-bind="text: GetData"></div>
</div>


<script type="text/javascript">

	$(function ()
	{
		// View Model Stuff
		var serverdata = $.parseJSON($("#jsondata").val());

		model = kendo.observable({
			name: serverdata.name,
			address: serverdata.address,
			postcode: serverdata.postcode,
			country: serverdata.country,

			countries: serverdata.countries,

			HandleSubmit: function ()
			{
				var jsonModel = model.toJSON();

				// Strip off reference data
				delete jsonModel.countries;


				$("#jsondata").val(JSON.stringify(jsonModel));

				return true;
			}
		});

		kendo.bind($("#mainform"), model);





		// UI Widget things

		$("#postcode").kendoNumericTextBox({
			step: 6,
			max: 7000,
			min: 1
		});
	});

</script>